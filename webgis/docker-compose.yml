#
# Docker Compose
# created 04.08.2017 by T.H.
# Todo:	
#	Change PASSWORD: root/postgres:passw0rd (PLEASE CHANGE THE DEFAULT PASSWORDS!)
#	Change Domain and E-Mail for Lets Encrypt
#	Optional: Change Timezones, List: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
#	sudo mkdir -p /srv/webgis/{mysql,postgresql,geoserver,nginx,ssl,html,letsencrypt}
#	sudo docker-compose up -d
#

version: "2.0"

services:

  mysql:
    #image: mysql:5.7
    image: mysql/mysql-server:5.7
    #image: mariadb:10.2
    environment:
      MYSQL_ROOT_PASSWORD: passw0rd
    #  MYSQL_USER: myuser
    #  MYSQL_PASSWORD: passw0rd
    #  MYSQL_DATABASE: mydatabase
    #ports:
    #  - "3306:3306"
    volumes:
      - ./mysql:/var/lib/mysql
    networks:
      webgis:
        aliases:
         - db
         - mariadb
  
  postgresql:
    #image: postgres:9.6
    image: mdillon/postgis:9.6
    environment:
      POSTGRES_PASSWORD: passw0rd
    #ports:
    #  - "5432:5432"
    volumes:
      - ./postgresql:/var/lib/postgresql/data
    networks:
      webgis:
        aliases:
         - postgis
         - postgres
         - pgsql
  
  geoserver:
    #image: kartoza/geoserver:latest #2.9.1
    image: oscarfonts/geoserver:2.11.2
    #ports:
    #  - "8088:8080"
    volumes:
    #  - ./geoserver:/opt/geoserver/data_dir
      - ./geoserver:/var/local/geoserver
    networks:
      webgis:
  
  phpapache:
    #image: php:7.0-apache
    image: tobi312/php:7.0-apache
    environment:
      TZ: "Europe/Berlin"
      PHP_ERRORS: 1
      PHP_UPLOAD_MAX_FILESIZE: 250
      ENABLE_REWRITE: 1
      ENABLE_SSL: 1
      REMOTEIP: 1
    #ports:
    #  - "8080:80"
    #  - "8443:443"
    volumes:
      - ./html:/var/www/html
    #  - ./ssl:/etc/ssl:ro
    networks:
      webgis:
  
  #php:
  #  #image: php:7.0-fpm
  #  image: tobi312/php:7.0-fpm
  #  environment:
  #    TZ: "Europe/Berlin"
  #    PHP_ERRORS: 1
  #    PHP_UPLOAD_MAX_FILESIZE: 250
  #  volumes:
  #    - ./html:/var/www/html
  #  networks:
  #    webgis:
  
  letsencrypt:
    image: quay.io/letsencrypt/letsencrypt:latest
    command:  bash -c "sleep 6 && certbot certonly --standalone -d __YOUR-DOMAIN__ -d www.__YOUR-DOMAIN__ --email __YOUR-EMAIL__ --text --agree-tos --server https://acme-v01.api.letsencrypt.org/directory --rsa-key-size 4096 --verbose --renew-by-default --standalone-supported-challenges http-01"
    entrypoint: ""
    #ports:
    #  - "80:80"
    #  - "443:443"
    volumes:
      - ./letsencrypt:/etc/letsencrypt
    #  - /var/lib/letsencrypt
    environment:
      - TERM=xterm
    networks:
      webgis:
  
  nginx:
    image: nginx:latest
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx:/etc/nginx/conf.d:ro
      - ./letsencrypt:/etc/letsencrypt:ro
      - ./ssl:/etc/nginx/ssl:ro
    #  - ./html:/var/www/html
    networks:
      webgis:

networks:
  webgis:
  
#volumes:
#  letsencrypt-data:
