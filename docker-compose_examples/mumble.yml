# docker-compose -f mumble.yml up -d
version: '2.4'
services:

  # NOT READY !!!! (read offical docs)

  # Mumble - voice-chat software
  # https://www.mumble.info/ + https://github.com/mumble-voip/mumble
  # https://hub.docker.com/r/mumblevoip/mumble-server + https://github.com/mumble-voip/mumble-docker
  # https://github.com/mumble-voip/mumble/blob/master/scripts/murmur.ini
  # Supported architectures: amd64, arm64
  # # fix permission problem before startup: mkdir ./mumble-data/ && chmod 777 ./mumble-data/
  # Password: set env or see in logs after start: docker logs mumble-server 2>&1 | grep SUPERUSER_PASSWORD
  # When login with "Superuser" and Password you have admin permission.
  mumble:
    image: mumblevoip/mumble-server:latest    # v1.4.230
    container_name: mumble-server
    restart: unless-stopped
    ports:
      - 64738:64738/tcp
      - 64738:64738/udp
    environment:
      TZ: Europe/Berlin
      #MUMBLE_ALLOWHTML: true
      #MUMBLE_ALLOWPING: true
      #MUMBLE_AUTOBANATTEMPTS: 10
      #MUMBLE_AUTOBANTIMEFRAME: 120
      #MUMBLE_AUTOBANTIME: 300
      #MUMBLE_BANDWIDTH: 7200
      #MUMBLE_CHANNELNAME: [ \\-=\\w\\#\\[\\]\\{\\}\\(\\)\\@\|]+
      #MUMBLE_DATABASE: /data/murmur.sqlite
      #MUMBLE_DB_DRIVER: QSQLITE
      #MUMBLE_DB_USERNAME: ---
      #MUMBLE_DB_PASSWORD: ---
      #MUMBLE_DEFAULTCHANNEL: ---
      #MUMBLE_ENABLESSL: 0
      #MUMBLE_ICE: tcp -h 127.0.0.1 -p 6502
      #MUMBLE_ICESECRETREAD: ---
      #MUMBLE_ICESECRETWRITE: ---
      #MUMBLE_IMAGEMESSAGELENGTH: 131072
      #MUMBLE_KDFITERATIONS: -1
      #MUMBLE_LEGACYPASSWORDHASH: false
      #MUMBLE_MESSAGEBURST: 5
      #MUMBLE_MESSAGELIMIT: 1
      #MUMBLE_OBFUSCATE: false
      #MUMBLE_OPUSTHRESHOLD: 100
      #MUMBLE_REGISTERHOSTNAME: ---
      #MUMBLE_REGISTERNAME: ---
      #MUMBLE_REGISTERPASSWORD: ---
      #MUMBLE_REGISTERURL: ---
      #MUMBLE_REMEMBERCHANNEL: true
      #MUMBLE_SENDVERSION: false
      #MUMBLE_SERVERPASSWORD: ---
      #MUMBLE_SSLCIPHERS: ---
      #MUMBLE_SSLPASSPHRASE: ---
      #MUMBLE_SUGGESTPOSITIONAL: ---
      #MUMBLE_SUGGESTPUSHTOTALK: ---
      #MUMBLE_SUGGESTVERSION: false
      #MUMBLE_TEXTMESSAGELENGTH: 5000
      #MUMBLE_TIMEOUT: 30
      #MUMBLE_USERNAME: [-=\\w\\[\\]\\{\\}\\(\\)\\@\|\\.]+
      #MUMBLE_USERS: 100
      #MUMBLE_USERSPERCHANNEL: 0
      #MUMBLE_WELCOMETEXT: "<br />Welcome to this server running <b>Murmur</b>.<br />Enjoy your stay!<br />"
      #SUPERUSER_PASSWORD: passw0rd # If not defined, a password will be auto-generated.
    volumes:
      #- mumble-data:/data:rw
      - ./mumble-data:/data:rw
    healthcheck:
      test:  ["CMD-SHELL", "mumble-server -version || exit 1"]
      interval: 60s
      timeout: 5s
      retries: 3
      #start_period: 30s

# before start mumble: mkdir ./mumble-data/    
#volumes:
#  mumble-data:
#    driver_opts:
#      type: none
#      device: ${PWD}/mumble-data
#      o: bind
